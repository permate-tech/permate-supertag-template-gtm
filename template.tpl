___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Permate SuperTag",
  "categories": ["AFFILIATE_MARKETING", "ADVERTISING", "ATTRIBUTION"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "The Permate SuperTag Template is a JavaScript library that contains all the necessary functions for Permate\u0027s tracking solution.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Permission
const log = require('logToConsole');
const getCookieValues = require('getCookieValues');
const setCookie = require('setCookie');
const getUrl = require('getUrl');
const JSON = require('JSON');
const parseUrl = require('parseUrl');
const getTimestampMillis = require('getTimestampMillis');
const getReferrerUrl = require('getReferrerUrl');
const encodeUriComponent = require('encodeUriComponent');
const callInWindow = require('callInWindow');

const SESSION_CLICK = 684000;
const TRACKING_DOMAIN = 'https://pmcloud1.com';
const SCRIPT_URL = TRACKING_DOMAIN + '/get_url';
const COOKIES_EXPIRES = 604800; // 7 days
const COOKIES_0_EXPIRES = 7776000; // 90 days

function setPmOCookie(host, isSecure, data) {
  setCookie('pm_cep_o', data.cep, {
    'domain': host,
    'path': '/',
    'max-age': COOKIES_0_EXPIRES,
    'secure': isSecure
  });
  setCookie('pm_click', JSON.stringify({campaign: data.campaign, click: data.click_id}), {
    'domain': host,
    'path': '/',
    'max-age': COOKIES_0_EXPIRES,
    'secure': isSecure
  });
}

function setFillParamsCookie(host, isSecure, fillParams) {
  setCookie('pm_q', fillParams, {
    'domain': host,
    'path': '/',
    'max-age': COOKIES_EXPIRES,
    'secure': isSecure
  });
}

function processData() {
  if (!TRACKING_DOMAIN) {
    log('TRACKING_DOMAIN is undefined');
    return;
  }
  let pId = '';
  let cookieClickId = '';
  let currentUrl = getUrl();
  let currentUrlObj = parseUrl(currentUrl) || {};
  let searchParamObj = {};
  let isSecure = 'https:' === currentUrlObj.protocol;

  if (currentUrlObj && currentUrlObj.searchParams) {
    searchParamObj = currentUrlObj.searchParams;
  }
  let cpId = searchParamObj.pm_cid;
  let clId = searchParamObj.pm_click_id;

  // Get cookieClickId & pId
  if (cpId) {
    if (clId) {
      pId = getCookieValues('p-' + cpId + clId)[0];
    } else {
      pId = getCookieValues('p-' + cpId)[0];
      let pmClick = getCookieValues('pm_click')[0];
      if (pmClick) {
        let jsonPMClick = JSON.parse(pmClick);
        let campaign = jsonPMClick.campaign;
        let click = jsonPMClick.click;
        if (campaign === cpId) {
          cookieClickId = click;
        }
      }
    }
  }

  // Get cep
  let cep = getCookieValues('pm_cep_o')[0];
  if (cep && !cpId) {
    let delimiter = currentUrl.indexOf('?') > -1 ? '&' : '?';
    currentUrl += delimiter + 'pm_cep=' + cep;
    pId = cep;
  } else if (cookieClickId) {
    var delimiter = currentUrl.indexOf('?') > -1 ? '&' : '?';
    currentUrl += delimiter + 'pm_click_id=' + cookieClickId;
  }

  if (!cpId && !cep) {
    return;
  }

  var sscMatch = getCookieValues('pm_ss_o')[0];
  if (pId && sscMatch) {
    var fillParams = getCookieValues('pm_q')[0];
    callInWindow('pmReplaceUrl', cep, fillParams, (data) => {
      if (data) {
        setFillParamsCookie(currentUrlObj.host, isSecure, data);
      }
    });
    return;
  } else {
    setCookie('pm_ss_o', '1', {
      'domain': currentUrlObj.host,
      'path': '/',
      'max-age': SESSION_CLICK,
      'secure': isSecure
    });
  }

  let referrer = getReferrerUrl('queryParams');
  let cdnScript = SCRIPT_URL + '?ref=' + encodeUriComponent(referrer) + '&location=o&url=' + encodeUriComponent(currentUrl) + '&time=' + getTimestampMillis();
  if (pId) {
    cdnScript += '&cid=no';
  }

  var fillParamData = getCookieValues('pm_q')[0];
  callInWindow('pmSendPixel', cdnScript, fillParamData, (data) => {
    if (data) {
      setPmOCookie(currentUrlObj.host, isSecure, data);
    }
  }, (data) => {
    if (data) {
      setFillParamsCookie(currentUrlObj.host, isSecure, data);
    }
  });

  if (cpId) {
    if (clId) {
      setCookie('p-' + cpId + clId, '1', {
        'domain': currentUrlObj.host,
        'path': '/',
        'max-age': COOKIES_EXPIRES,
        'secure': isSecure
      });
    } else {
      setCookie('p-' + cpId, '1', {
        'domain': currentUrlObj.host,
        'path': '/',
        'max-age': COOKIES_EXPIRES,
        'secure': isSecure
      });
    }
  }
}

processData();

data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_referrer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "pmSendPixel"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "pmReplaceUrl"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Quick Test
  code: runCode();
setup: ''


___NOTES___

Created on 12/6/2024, 4:04:14 PM
